<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <title>Regular Show Wiki</title>
</head>
<body>

    <div class="header">
        <img src="../img/logoregularshow.png" alt="logo-regular-show">
    </div>

    <div class="contenedor">
        <header>
            <nav>
                <ul>
                <li><a href="../index.html">Inicio</a></li>
                <li><a href="api-doc.html">Regular Show API Docs</a></li>
                <li><a href="personajes.html">Personajes</a></li>
                <li><a href="capitulos.html">Capitulos</a></li>
                <!--<li><a href="comics.html">Comics</a></li>-->
                <li><a href="la-pelicula.html">La Pelicula</a></li>                    
                <li><a href="acerca-de.html">Acerca de</a></li>
                </ul>
            </nav>
         </header>

        <section class="main">
            <div class="imagen-desktop">
                <img src="../img/Regular-Show-Final.png" alt="final-regular-show">
            </div>
            <section class="posts">

                <article>
                    <h3>Ficha del capítulo (desde la API)</h3>
                    <div id="final-episode" class="episode-card" style="margin-top:10px;">
                        <div class="episode-card__media"></div>
                        <div class="episode-card__body">
                        <div class="episode-card__title">Cargando…</div>
                        <ul class="episode-card__meta"></ul>
                        <p class="episode-card__sinopsis"></p>
                        </div>
                    </div>
                </article>

                <article>
                    <br><br>
                    <h2>Una Épica Batalla Final Más</h2>
                        <img width="100%" src="../img/final-cap/final-battle.jpg" alt="">
                    <br><br>
                    <p>
                        Después de ocho temporadas de bromas internas, locuras cósmicas y amistades improbables,
                        <strong>Regular Show</strong> cierra su viaje con una despedida que es tan absurda como
                        profundamente humana. El destino del universo descansa —literalmente— en las manos de
                        <strong>Papaleta</strong>, quien descubre que su bondad no es una debilidad sino la
                        fuerza más grande que tiene.
                    </p>
                    <p>
                        La batalla final enfrenta a Papaleta con su hermano gemelo <em>Anti-Pops</em>, una colisión
                        de opuestos que sacude galaxias, dobla el tiempo y deja a nuestros amigos atrapados entre
                        la épica y lo íntimo. <strong>Mordecai</strong> y <strong>Rigby</strong>, los dos flojos
                        más entrañables del parque, han crecido sin darse cuenta: ya no huyen, se quedan. Ya no
                        bromean, acompañan. Cuando la pelea se vuelve imposible de ganar por la fuerza, Papaleta
                        entiende lo que la serie nos venía susurrando desde el piloto: <em>hay finales que se
                        ganan eligiendo soltar</em>.
                    </p>
                        <br>
                        <img width="100%" src="../img/final-cap/anti papaleta.jpg" alt="">
                        <img width="100%" src="../img/final-cap/batalla.jpg" alt="">
                        <br>
                    <p>
                        Su decisión lo cambia todo. El universo se reescribe con un último abrazo, una última
                        sonrisa y una carta que deja paz. El equipo vuelve a casa y el tiempo, caprichoso, avanza.
                        Vemos el futuro en pequeñas postales: <strong>Rigby</strong> forma una familia junto a
                        <strong>Eileen</strong>; <strong>Mordecai</strong> encuentra su vocación en el arte y
                        también un hogar; <strong>Skips</strong> sigue siendo el corazón antiguo del parque;
                        <strong>Musculoso</strong> y <strong>Starla</strong> gritan su amor con la misma fuerza
                        con la que cuidan a sus hijos; <strong>Fantasmano</strong> aterriza en una vida tranquila;
                        <strong>Benson</strong> aprende a abrir su propio frasco de paciencia y de cariño.
                    </p>
                        <br>
                        <img width="100%" src="../img/final-cap/regular-show.png" alt=""> 
                        <img width="100%" src="../img/final-cap/los-papaleta.jpg" alt="">
                    <p>
                        El parque sigue ahí —con cicatrices y risas— y la ausencia de Papaleta se vuelve presencia:
                        un recuerdo que no duele, empuja. Cuando los amigos se juntan años después a mirar un viejo
                        video, entendemos que <em>Regular Show</em> no trató de nunca crecer, sino de aprender a
                        hacerlo juntos. <strong>Fin</strong>, pero de los bonitos.
                    </p>

                    <br>
                    <img width="100%" src="../img/final-cap/el-final.jpg" alt="">
                    <br><br>

                    <h3>Temas que cierran la serie</h3>
                    <ul>
                        <li><strong>Amistad y lealtad:</strong> Mordecai y Rigby eligen estar, incluso cuando da miedo.</li>
                        <li><strong>Madurar no es dejar de jugar:</strong> es saber por qué y con quién lo haces.</li>
                        <li><strong>El sacrificio de Papaleta:</strong> la bondad como forma de fuerza.</li>
                        <li><strong>El tiempo:</strong> aceptar que crecer también es despedirse.</li>
                    </ul>
                    

                </article>



            </section>
        </section>

        <aside>
            <div class="widget">
                <div class="imagen">
                    <img src="../img/aside/final-papaleta.jpg" alt="">
                </div>
                <h3 class="titulo">Regular Show - La Pelicula -</h3><br>
                <p>Un Show mas (Historias corrientes en España y Regular Show en ingles) es una serie animada estadounidense creada por <a href="https://es.wikipedia.org/wiki/J._G._Quintel" target="_blank">J.G. Quintel.</a><br><br>
                Fue aprobada el 13 de agosto de 2009 por <a href="https://es.wikipedia.org/wiki/Cartoon_Network" target="_blank">Cartoon Netwowrk</a> en su episodio piloto
                y se estreno en Latinoamerica el 11 de Agosto del 2010.<br><br>
                Con 8 temporadas de 261 episodios una Pelicula, 40 comics de Mordecai y Rigby mas 6 tomos especiales de Skips y con 7 premios Emmy por Mejor serie animada,
                Un show mas se volvio una de las series mas vistas y populares de Cartoon Network, ganando un puesto como un clasico y una serie muy querida por todos quienes la vieron.</p>
            </div>

            <div class="widget">
                <h3 class="titulo">Articulos Destacados</h3>
                <ul>
                    <li><a href="../pages/top-imdb.html">TOP 10 Capitulos segun IMDb</a></li>
                    <li><a href="../pages/villanos.html">Algunos villanos</a></li>
                    <li><a href="../pages/cap-final.html">El final de la serie</a></li>
                </ul>
            </div>
        </aside>

        <!-- Footer -->
        <div id="footer-placeholder"></div>
        <script>
            fetch('../partials/footer.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('footer-placeholder').innerHTML = data;
                });
        </script>
    </div>
    <script>
        (function () {
        const API = "https://apiregularshow.onrender.com";
        const KNOWN_ID = "CAP243";

        const norm = s => (s||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase();
        const $ = sel => document.querySelector(sel);

        async function fetchFinalEpisode() {
            if (KNOWN_ID) {
            const r = await fetch(`${API}/capitulos/${KNOWN_ID}`);
            if (r.ok) return await r.json();
            }
            const PAGE = 100;
            let skip = 0;
            const all = [];
            while (true) {
            const url = `${API}/capitulos?skip=${skip}&limit=${PAGE}`;
            const res = await fetch(url);
            if (!res.ok) throw new Error(`HTTP ${res.status} en ${url}`);
            const page = await res.json();
            if (!Array.isArray(page) || page.length === 0) break;
            all.push(...page);
            if (page.length < PAGE) break;
            skip += PAGE;
            if (skip > 1000) break;
            }

            const target = all.find(ep => {
                const titulo = ep.titulo_es || ep.titulo_eng || ep.titulo || "";
                return norm(titulo).includes("epica batalla final");
            });
            if (!target) throw new Error("No se encontró el capítulo final por título.");
            return target;
        }

        function renderEpisode(ep) {
            const wrap = $("#final-episode");
            if (!wrap) return;
            const media = wrap.querySelector(".episode-card__media");
            const title = wrap.querySelector(".episode-card__title");
            const meta  = wrap.querySelector(".episode-card__meta");
            const sin   = wrap.querySelector(".episode-card__sinopsis");

            // Manejar títulos en español e inglés
            const titulo = ep.titulo_es || ep.titulo_eng || ep.titulo || "Sin título";

            const img = ep.imagen_url || "../img/placeholder-episodio.jpg";
            media.innerHTML = `<img class="episode-card__img" src="${img}" alt="Capítulo ${titulo}">`;
            title.textContent = titulo;

            const imd = ep.imdb_score ?? "N/A";
            const temp = String(ep.temporada ?? "—").padStart(2,"0");
            const num  = String(ep.capitulo ?? ep.numero ?? "—").padStart(2,"0");
            const date = ep.fecha_estreno || "Desconocido";

            meta.innerHTML = `
            <li><b>Temporada:</b> ${temp}</li>
            <li><b>Capítulo:</b> ${num}</li>
            <li><b>Estreno:</b> ${date}</li>
            <li><b>IMDb:</b> ${imd}</li>
            <li><b>ID:</b> ${ep.id}</li>
            `;
            sin.textContent = ep.sinopsis || "Sinopsis no disponible en la API.";
        }

        document.addEventListener("DOMContentLoaded", async () => {
            const box = document.querySelector("#final-episode .episode-card__title");
            try {
            if (box) box.textContent = "Cargando datos de la API…";
            const ep = await fetchFinalEpisode();
            renderEpisode(ep);
            } catch (err) {
            console.error(err);
            if (box) box.textContent = "No se pudo cargar la ficha del capítulo.";
            }
        });
        })();
    </script>

    
</body>
</html>